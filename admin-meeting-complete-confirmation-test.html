<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Meeting Complete Confirmation Test</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f9fafb;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { 
            Calendar, Clock, MapPin, User, Phone, Mail, Package, Eye, 
            Search, Filter, CheckCircle, XCircle, AlertCircle, Check, RefreshCw 
        } = lucide;

        // Mock meeting data
        const mockMeetings = [
            {
                id: 'meeting-001',
                purchaseId: 'purchase-001',
                buyerId: 'buyer-001',
                sellerId: 'seller-001',
                buyerName: 'John Smith',
                sellerName: 'Alice Johnson',
                buyerEmail: 'john.smith@example.com',
                sellerEmail: 'alice.johnson@example.com',
                buyerPhone: '+94 77 123 4567',
                sellerPhone: '+94 71 987 6543',
                gemName: 'Ceylon Blue Sapphire',
                gemType: 'Sapphire',
                finalPrice: 25000,
                commissionAmount: 2500,
                primaryImageUrl: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=300&h=200&fit=crop',
                proposedDateTime: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                confirmedDateTime: new Date(Date.now() + 48 * 60 * 60 * 1000).toISOString(),
                location: 'GemNet Office, Colombo',
                meetingType: 'VERIFICATION',
                status: 'CONFIRMED',
                buyerNotes: 'Looking forward to the verification meeting',
                sellerNotes: 'Will bring all certificates',
                createdAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                updatedAt: new Date().toISOString(),
                paymentStatus: 'PENDING'
            },
            {
                id: 'meeting-002',
                purchaseId: 'purchase-002',
                buyerId: 'buyer-002',
                sellerId: 'seller-002',
                buyerName: 'Michael Brown',
                sellerName: 'Sarah Davis',
                buyerEmail: 'michael.brown@example.com',
                sellerEmail: 'sarah.davis@example.com',
                buyerPhone: '+94 76 234 5678',
                sellerPhone: '+94 75 876 5432',
                gemName: 'Pink Padparadscha',
                gemType: 'Padparadscha',
                finalPrice: 45000,
                commissionAmount: 4500,
                primaryImageUrl: 'https://images.unsplash.com/photo-1544829099-b9a0c5303bea?w=300&h=200&fit=crop',
                proposedDateTime: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(),
                location: 'GemNet Office, Kandy',
                meetingType: 'HANDOVER',
                status: 'CONFIRMED',
                buyerNotes: 'Need to verify authenticity',
                createdAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
                updatedAt: new Date().toISOString(),
                paymentStatus: 'PENDING'
            }
        ];

        const AdminMeetingCompleteTest = () => {
            const [meetings, setMeetings] = useState(mockMeetings);
            const [showCompleteConfirmModal, setShowCompleteConfirmModal] = useState(false);
            const [meetingToComplete, setMeetingToComplete] = useState(null);
            const [updatingMeeting, setUpdatingMeeting] = useState(null);
            const [message, setMessage] = useState(null);

            // Get proper image URL
            const getImageUrl = (imageUrl, gemName) => {
                if (imageUrl) {
                    if (imageUrl.startsWith('http://') || imageUrl.startsWith('https://')) {
                        return imageUrl;
                    }
                    return `http://localhost:9092/${imageUrl.startsWith('/') ? imageUrl.slice(1) : imageUrl}`;
                }
                
                const gemType = gemName?.toLowerCase() || '';
                if (gemType.includes('ruby')) {
                    return 'https://images.unsplash.com/photo-1506792006437-256b665541e2?w=300&h=200&fit=crop';
                } else if (gemType.includes('sapphire')) {
                    return 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=300&h=200&fit=crop';
                } else if (gemType.includes('emerald') || gemType.includes('padparadscha')) {
                    return 'https://images.unsplash.com/photo-1544829099-b9a0c5303bea?w=300&h=200&fit=crop';
                } else {
                    return 'https://images.unsplash.com/photo-1506792006437-256b665541e2?w=300&h=200&fit=crop';
                }
            };

            // Show confirmation modal before completing meeting
            const handleCompleteButtonClick = (meeting) => {
                setMeetingToComplete(meeting);
                setShowCompleteConfirmModal(true);
            };

            // Simulate completion action
            const confirmCompletion = async () => {
                if (meetingToComplete) {
                    setUpdatingMeeting(meetingToComplete.id);
                    
                    // Simulate API delay
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // Update meeting status
                    setMeetings(prev => prev.map(m => 
                        m.id === meetingToComplete.id 
                            ? { ...m, status: 'COMPLETED' }
                            : m
                    ));
                    
                    setMessage({ 
                        type: 'success', 
                        text: 'Meeting marked as completed successfully. Notifications sent to both parties.' 
                    });
                    setTimeout(() => setMessage(null), 5000);
                    
                    // Close confirmation modal
                    setShowCompleteConfirmModal(false);
                    setMeetingToComplete(null);
                    setUpdatingMeeting(null);
                }
            };

            return (
                <div className="test-container">
                    <div className="test-section">
                        <h1 className="text-2xl font-bold text-gray-900 mb-6">
                            Admin Meeting Complete Confirmation Test
                        </h1>
                        
                        {/* Message Display */}
                        {message && (
                            <div className={`mb-6 p-4 rounded-lg border-l-4 ${
                                message.type === 'success' ? 'bg-green-50 border-green-400 text-green-700' :
                                message.type === 'error' ? 'bg-red-50 border-red-400 text-red-700' :
                                'bg-blue-50 border-blue-400 text-blue-700'
                            }`}>
                                <div className="flex items-center justify-between">
                                    <span>{message.text}</span>
                                    <button
                                        onClick={() => setMessage(null)}
                                        className="ml-3 text-gray-400 hover:text-gray-600"
                                    >
                                        <XCircle className="w-5 h-5" />
                                    </button>
                                </div>
                            </div>
                        )}

                        <p className="text-gray-600 mb-8">
                            This test demonstrates the confirmation modal that appears when admin clicks the Complete button 
                            next to meeting details. Click on the "Complete" button below to see the confirmation dialog in action.
                        </p>

                        {/* Sample Meeting Cards */}
                        <div className="space-y-4">
                            {meetings.map((meeting) => (
                                <div key={meeting.id} className="bg-white border border-gray-200 rounded-lg p-4">
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center space-x-4">
                                            <img
                                                src={getImageUrl(meeting.primaryImageUrl, meeting.gemName)}
                                                alt={meeting.gemName}
                                                className="w-16 h-16 rounded-lg object-cover border border-gray-200"
                                            />
                                            <div>
                                                <h3 className="font-semibold text-gray-900">{meeting.gemName}</h3>
                                                <p className="text-sm text-gray-600">{meeting.gemType}</p>
                                                <p className="text-sm text-gray-500">
                                                    {meeting.buyerName} ↔ {meeting.sellerName}
                                                </p>
                                                <p className="text-sm font-medium text-green-600">
                                                    LKR {meeting.finalPrice?.toLocaleString()}
                                                </p>
                                            </div>
                                        </div>
                                        
                                        <div className="flex items-center space-x-2">
                                            <span className={`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${
                                                meeting.status === 'CONFIRMED' ? 'bg-green-100 text-green-800' :
                                                meeting.status === 'COMPLETED' ? 'bg-blue-100 text-blue-800' :
                                                'bg-gray-100 text-gray-800'
                                            }`}>
                                                {meeting.status}
                                            </span>
                                            
                                            <button
                                                className="flex items-center space-x-1 px-2 py-1 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 transition-colors text-xs"
                                            >
                                                <Eye className="w-3 h-3" />
                                                <span>Details</span>
                                            </button>
                                            
                                            {meeting.status === 'CONFIRMED' && (
                                                <button
                                                    onClick={() => handleCompleteButtonClick(meeting)}
                                                    disabled={updatingMeeting === meeting.id}
                                                    className="flex items-center space-x-1 px-2 py-1 bg-green-100 text-green-700 rounded-md hover:bg-green-200 transition-colors text-xs disabled:opacity-50 disabled:cursor-not-allowed"
                                                >
                                                    {updatingMeeting === meeting.id ? (
                                                        <div className="animate-spin rounded-full h-3 w-3 border-b border-green-700"></div>
                                                    ) : (
                                                        <Check className="w-3 h-3" />
                                                    )}
                                                    <span>Complete</span>
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Confirmation Modal for Completing Meeting */}
                    {showCompleteConfirmModal && meetingToComplete && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl max-w-md w-full shadow-2xl">
                                <div className="p-6">
                                    {/* Modal Header */}
                                    <div className="flex items-center justify-between mb-4">
                                        <div className="flex items-center">
                                            <div className="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                                <Check className="w-5 h-5 text-green-600" />
                                            </div>
                                            <h3 className="text-lg font-semibold text-gray-900">Complete Meeting</h3>
                                        </div>
                                        <button
                                            onClick={() => {
                                                setShowCompleteConfirmModal(false);
                                                setMeetingToComplete(null);
                                            }}
                                            className="text-gray-400 hover:text-gray-600 p-1"
                                        >
                                            <XCircle className="w-5 h-5" />
                                        </button>
                                    </div>

                                    {/* Modal Content */}
                                    <div className="mb-6">
                                        <p className="text-gray-700 mb-4">
                                            Are you sure you want to mark this meeting as completed?
                                        </p>
                                        
                                        {/* Meeting Details Summary */}
                                        <div className="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                            <div className="flex items-center space-x-3 mb-3">
                                                <img
                                                    src={getImageUrl(meetingToComplete.primaryImageUrl, meetingToComplete.gemName)}
                                                    alt={meetingToComplete.gemName || 'Gem'}
                                                    className="w-12 h-12 rounded-lg object-cover border border-gray-200"
                                                />
                                                <div>
                                                    <p className="font-medium text-gray-900">{meetingToComplete.gemName}</p>
                                                    <p className="text-sm text-gray-600">
                                                        {meetingToComplete.buyerName} ↔ {meetingToComplete.sellerName}
                                                    </p>
                                                </div>
                                            </div>
                                            
                                            <div className="text-sm text-gray-600">
                                                <p><span className="font-medium">Meeting ID:</span> {meetingToComplete.id.slice(-8)}</p>
                                                <p><span className="font-medium">Location:</span> {meetingToComplete.location}</p>
                                                <p><span className="font-medium">Final Price:</span> LKR {meetingToComplete.finalPrice?.toLocaleString()}</p>
                                            </div>
                                        </div>

                                        <div className="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                                            <div className="flex items-start">
                                                <AlertCircle className="w-5 h-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0" />
                                                <div className="text-sm text-yellow-800">
                                                    <p className="font-medium mb-1">Important:</p>
                                                    <p>Once marked as completed, both parties will be notified and this action cannot be undone. Please ensure the meeting has actually taken place and all requirements have been fulfilled.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Modal Actions */}
                                    <div className="flex justify-end space-x-3">
                                        <button
                                            onClick={() => {
                                                setShowCompleteConfirmModal(false);
                                                setMeetingToComplete(null);
                                            }}
                                            className="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            onClick={confirmCompletion}
                                            disabled={updatingMeeting === meetingToComplete.id}
                                            className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2"
                                        >
                                            {updatingMeeting === meetingToComplete.id ? (
                                                <>
                                                    <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                                                    <span>Completing...</span>
                                                </>
                                            ) : (
                                                <>
                                                    <Check className="w-4 h-4" />
                                                    <span>Yes, Complete Meeting</span>
                                                </>
                                            )}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<AdminMeetingCompleteTest />, document.getElementById('root'));
    </script>
</body>
</html>