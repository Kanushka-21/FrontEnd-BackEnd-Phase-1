<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Meeting Details Modal Test</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #f8fafc;
            font-family: system-ui, -apple-system, sans-serif;
        }
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            padding: 1rem;
        }
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }
        .status-confirmed { background-color: #dcfce7; color: #166534; }
        .status-pending { background-color: #fef3c7; color: #92400e; }
        .status-completed { background-color: #e0e7ff; color: #3730a3; }
        .status-cancelled { background-color: #fee2e2; color: #dc2626; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        const { Calendar, Clock, MapPin, User, Phone, Mail, Package, Eye, XCircle, Check } = lucide;

        // Mock meeting data matching the user's description
        const mockMeeting = {
            id: "68c4851ee9fd231b78dd3870",
            purchaseId: "68c48481e9fd231b78dd3869",
            buyerId: "68c43321928b1052a17af6ec",
            sellerId: "6866a0610e7d6d09625f96c6",
            buyerName: "pasindu perera",
            sellerName: "Dinushi hansani",
            buyerEmail: "iit21001@std.uwu.ac.lk",
            sellerEmail: "iit21017@std.uwu.ac.lk",
            buyerPhone: "+94701418312",
            sellerPhone: "+94705883113",
            gemName: "Natural Emerald",
            gemType: "Natural Emerald",
            finalPrice: 1133333336.22,
            commissionAmount: 113333333.62,
            primaryImageUrl: "/uploads/gem-images/emerald-sample.jpg", // This will test the URL formatting
            proposedDateTime: "2025-09-13T02:29:00Z",
            confirmedDateTime: "2025-09-13T02:29:00Z",
            location: "Rathnapura Office",
            meetingType: "PHYSICAL",
            status: "CONFIRMED",
            buyerNotes: "resedul",
            sellerNotes: "ok",
            createdAt: "2025-09-13T02:09:57Z",
            updatedAt: "2025-09-13T02:30:27Z"
        };

        const AdminMeetingDetailsTest = () => {
            const [showModal, setShowModal] = useState(true);
            const [updatingMeeting, setUpdatingMeeting] = useState(null);

            // Get proper image URL function (matching the fixed implementation)
            const getImageUrl = (imageUrl, gemName) => {
                if (imageUrl) {
                    // If it's already a full URL, return as is
                    if (imageUrl.startsWith('http://') || imageUrl.startsWith('https://')) {
                        return imageUrl;
                    }
                    // If it's a relative path, prepend the backend URL
                    if (imageUrl.startsWith('/uploads/') || imageUrl.startsWith('uploads/')) {
                        return `http://localhost:9092/${imageUrl.startsWith('/') ? imageUrl.slice(1) : imageUrl}`;
                    }
                    // If it's just a filename, assume it's in gem-images
                    return `http://localhost:9092/uploads/gem-images/${imageUrl}`;
                }
                
                // Fallback images based on gem type
                const gemType = gemName?.toLowerCase() || '';
                if (gemType.includes('ruby')) {
                    return 'https://images.unsplash.com/photo-1506792006437-256b665541e2?w=300&h=200&fit=crop';
                } else if (gemType.includes('sapphire')) {
                    return 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=300&h=200&fit=crop';
                } else if (gemType.includes('emerald')) {
                    return 'https://images.unsplash.com/photo-1544829099-b9a0c5303bea?w=300&h=200&fit=crop';
                } else {
                    return 'https://images.unsplash.com/photo-1506792006437-256b665541e2?w=300&h=200&fit=crop';
                }
            };

            const markAsCompleted = async (meetingId) => {
                setUpdatingMeeting(meetingId);
                // Simulate API call
                setTimeout(() => {
                    setUpdatingMeeting(null);
                    alert('Meeting marked as completed!');
                }, 1500);
            };

            return (
                <div className="p-6">
                    <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                        <h1 className="text-2xl font-bold text-gray-900 mb-4">
                            🔧 Admin Meeting Details Modal - Updated
                        </h1>
                        <p className="text-gray-600 mb-4">
                            Testing the updated admin meeting details modal with fixed image loading 
                            and recent modifications. This modal shows all meeting information with 
                            proper image URL handling.
                        </p>
                        
                        {/* Fix Summary */}
                        <div className="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                            <div className="flex items-center space-x-2">
                                <Check className="w-5 h-5 text-green-600" />
                                <h3 className="font-medium text-green-800">✅ Image Loading Fix Applied</h3>
                            </div>
                            <ul className="mt-2 text-sm text-green-700 space-y-1">
                                <li>• Modal now uses <code>getImageUrl()</code> function for proper image handling</li>
                                <li>• Supports backend uploaded images via correct URL formatting</li>
                                <li>• Fallback to gem-type-specific Unsplash images on error</li>
                                <li>• Consistent with table view image handling</li>
                                <li>• Admin contact information properly displayed for oversight</li>
                            </ul>
                        </div>

                        <button
                            onClick={() => setShowModal(true)}
                            className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
                        >
                            Open Updated Meeting Details Modal
                        </button>
                    </div>

                    {/* Enhanced Meeting Details Modal */}
                    {showModal && (
                        <div className="modal-backdrop">
                            <div className="bg-white rounded-xl max-w-5xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
                                <div className="p-6">
                                    {/* Modal Header */}
                                    <div className="flex items-center justify-between mb-6 border-b border-gray-200 pb-4">
                                        <div>
                                            <h3 className="text-2xl font-bold text-gray-900">Meeting Details</h3>
                                            <p className="text-sm text-gray-600 mt-1">Complete information about this meeting</p>
                                        </div>
                                        <div className="flex items-center space-x-3">
                                            {/* Mark as Completed Button in Modal */}
                                            {mockMeeting.status === 'CONFIRMED' && (
                                                <button
                                                    onClick={() => markAsCompleted(mockMeeting.id)}
                                                    disabled={updatingMeeting === mockMeeting.id}
                                                    className="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                                >
                                                    {updatingMeeting === mockMeeting.id ? (
                                                        <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                                                    ) : (
                                                        <Check className="w-4 h-4" />
                                                    )}
                                                    <span>Mark as Completed</span>
                                                </button>
                                            )}
                                            <button
                                                onClick={() => setShowModal(false)}
                                                className="text-gray-400 hover:text-gray-600 p-2"
                                            >
                                                <XCircle className="w-6 h-6" />
                                            </button>
                                        </div>
                                    </div>

                                    {/* Main Content */}
                                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                        {/* Item Information with Large Image */}
                                        <div className="lg:col-span-1">
                                            <div className="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-5 border border-purple-200">
                                                <h4 className="font-bold text-gray-900 mb-4 flex items-center">
                                                    <Package className="w-5 h-5 mr-2 text-purple-600" />
                                                    Item Details
                                                </h4>
                                                
                                                {/* Large Item Image - FIXED */}
                                                <div className="mb-4">
                                                    <img
                                                        src={getImageUrl(mockMeeting.primaryImageUrl, mockMeeting.gemName)}
                                                        alt={mockMeeting.gemName || 'Gem Image'}
                                                        className="w-full h-48 rounded-lg object-cover border-4 border-white shadow-lg"
                                                        onError={(e) => {
                                                            const target = e.target;
                                                            target.src = getImageUrl(undefined, mockMeeting.gemName);
                                                        }}
                                                    />
                                                </div>
                                                
                                                {/* Item Information */}
                                                <div className="space-y-3">
                                                    <div>
                                                        <p className="font-bold text-xl text-gray-900">{mockMeeting.gemName || 'Unknown Gem'}</p>
                                                        <p className="text-purple-700 font-medium">{mockMeeting.gemType || 'Gemstone'}</p>
                                                    </div>
                                                    
                                                    <div className="bg-white rounded-lg p-3 border border-purple-200">
                                                        <p className="text-sm font-medium text-gray-600 mb-1">Final Price</p>
                                                        <p className="text-2xl font-bold text-green-600">
                                                            LKR {mockMeeting.finalPrice ? mockMeeting.finalPrice.toLocaleString() : '0'}
                                                        </p>
                                                        {mockMeeting.commissionAmount && (
                                                            <p className="text-sm text-gray-500 mt-1">
                                                                Commission: LKR {mockMeeting.commissionAmount.toLocaleString()}
                                                            </p>
                                                        )}
                                                    </div>

                                                    <div className="bg-white rounded-lg p-3 border border-purple-200">
                                                        <p className="text-sm font-medium text-gray-600 mb-2">Status & IDs</p>
                                                        <div className="space-y-2">
                                                            <div>
                                                                <span className={`status-badge status-${mockMeeting.status.toLowerCase()}`}>
                                                                    {mockMeeting.status || 'PENDING'}
                                                                </span>
                                                            </div>
                                                            <div className="text-xs space-y-1 text-gray-500">
                                                                <p>Meeting ID: <span className="font-mono">{mockMeeting.id}</span></p>
                                                                <p>Purchase ID: <span className="font-mono">{mockMeeting.purchaseId}</span></p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Participants and Meeting Info */}
                                        <div className="lg:col-span-2">
                                            <div className="space-y-6">
                                                {/* Meeting Information */}
                                                <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-5 border border-blue-200">
                                                    <h4 className="font-bold text-gray-900 mb-4 flex items-center">
                                                        <Calendar className="w-5 h-5 mr-2 text-blue-600" />
                                                        Meeting Schedule & Location
                                                    </h4>
                                                    
                                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                        {/* Date and Time */}
                                                        <div className="bg-white rounded-lg p-4 border border-blue-200">
                                                            <div className="space-y-3">
                                                                <div>
                                                                    <p className="text-sm font-medium text-gray-600 mb-1">Proposed Date & Time</p>
                                                                    <div className="flex items-center text-gray-800">
                                                                        <Calendar className="w-4 h-4 mr-2 text-blue-500" />
                                                                        <span className="font-medium">
                                                                            {new Date(mockMeeting.proposedDateTime).toLocaleDateString('en-GB', {
                                                                                weekday: 'long',
                                                                                year: 'numeric',
                                                                                month: 'long',
                                                                                day: 'numeric'
                                                                            })}
                                                                        </span>
                                                                    </div>
                                                                    <div className="flex items-center text-gray-700 mt-1">
                                                                        <Clock className="w-4 h-4 mr-2 text-blue-500" />
                                                                        <span>
                                                                            {new Date(mockMeeting.proposedDateTime).toLocaleTimeString('en-GB', {
                                                                                hour: '2-digit',
                                                                                minute: '2-digit'
                                                                            })}
                                                                        </span>
                                                                    </div>
                                                                </div>

                                                                {mockMeeting.confirmedDateTime && (
                                                                    <div>
                                                                        <p className="text-sm font-medium text-gray-600 mb-1">Confirmed Date & Time</p>
                                                                        <div className="flex items-center text-gray-800">
                                                                            <Calendar className="w-4 h-4 mr-2 text-green-500" />
                                                                            <span className="font-medium">
                                                                                {new Date(mockMeeting.confirmedDateTime).toLocaleDateString('en-GB', {
                                                                                    weekday: 'long',
                                                                                    year: 'numeric',
                                                                                    month: 'long',
                                                                                    day: 'numeric'
                                                                                })}
                                                                            </span>
                                                                        </div>
                                                                        <div className="flex items-center text-gray-700 mt-1">
                                                                            <Clock className="w-4 h-4 mr-2 text-green-500" />
                                                                            <span>
                                                                                {new Date(mockMeeting.confirmedDateTime).toLocaleTimeString('en-GB', {
                                                                                    hour: '2-digit',
                                                                                    minute: '2-digit'
                                                                                })}
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>

                                                        {/* Location Info */}
                                                        <div className="bg-white rounded-lg p-4 border border-blue-200">
                                                            <div className="space-y-3">
                                                                <div>
                                                                    <p className="text-sm font-medium text-gray-600 mb-1">Meeting Location</p>
                                                                    <div className="flex items-center text-gray-800">
                                                                        <MapPin className="w-4 h-4 mr-2 text-blue-500" />
                                                                        <span className="font-medium">{mockMeeting.location}</span>
                                                                    </div>
                                                                </div>
                                                                <div>
                                                                    <p className="text-sm font-medium text-gray-600 mb-1">Meeting Type</p>
                                                                    <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                                        {mockMeeting.meetingType}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Participants Information */}
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                    {/* Buyer Details */}
                                                    <div className="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-5 border-l-4 border-green-400">
                                                        <h4 className="font-bold text-green-800 mb-4 flex items-center">
                                                            <User className="w-5 h-5 mr-2" />
                                                            Buyer Information
                                                        </h4>
                                                        <div className="space-y-3">
                                                            <div>
                                                                <p className="text-lg font-bold text-gray-900">{mockMeeting.buyerName || 'N/A'}</p>
                                                                <p className="text-xs text-gray-500 font-mono">{mockMeeting.buyerId}</p>
                                                            </div>
                                                            
                                                            <div className="space-y-2">
                                                                <div className="flex items-center">
                                                                    <Mail className="w-4 h-4 text-green-600 mr-2 flex-shrink-0" />
                                                                    <span className="text-sm text-gray-700 break-all">{mockMeeting.buyerEmail || 'N/A'}</span>
                                                                </div>
                                                                <div className="flex items-center">
                                                                    <Phone className="w-4 h-4 text-green-600 mr-2 flex-shrink-0" />
                                                                    <span className="text-sm text-gray-700">{mockMeeting.buyerPhone || 'N/A'}</span>
                                                                </div>
                                                            </div>

                                                            {mockMeeting.buyerNotes && (
                                                                <div className="bg-white rounded-lg p-3 border border-green-200">
                                                                    <p className="text-sm font-medium text-gray-600 mb-1">Buyer Notes</p>
                                                                    <p className="text-sm text-gray-700">{mockMeeting.buyerNotes}</p>
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>

                                                    {/* Seller Details */}
                                                    <div className="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-5 border-l-4 border-blue-400">
                                                        <h4 className="font-bold text-blue-800 mb-4 flex items-center">
                                                            <User className="w-5 h-5 mr-2" />
                                                            Seller Information
                                                        </h4>
                                                        <div className="space-y-3">
                                                            <div>
                                                                <p className="text-lg font-bold text-gray-900">{mockMeeting.sellerName || 'N/A'}</p>
                                                                <p className="text-xs text-gray-500 font-mono">{mockMeeting.sellerId}</p>
                                                            </div>
                                                            
                                                            <div className="space-y-2">
                                                                <div className="flex items-center">
                                                                    <Mail className="w-4 h-4 text-blue-600 mr-2 flex-shrink-0" />
                                                                    <span className="text-sm text-gray-700 break-all">{mockMeeting.sellerEmail || 'N/A'}</span>
                                                                </div>
                                                                <div className="flex items-center">
                                                                    <Phone className="w-4 h-4 text-blue-600 mr-2 flex-shrink-0" />
                                                                    <span className="text-sm text-gray-700">{mockMeeting.sellerPhone || 'N/A'}</span>
                                                                </div>
                                                            </div>

                                                            {mockMeeting.sellerNotes && (
                                                                <div className="bg-white rounded-lg p-3 border border-blue-200">
                                                                    <p className="text-sm font-medium text-gray-600 mb-1">Seller Notes</p>
                                                                    <p className="text-sm text-gray-700">{mockMeeting.sellerNotes}</p>
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Timestamps */}
                                                <div className="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                                    <h4 className="font-semibold text-gray-900 mb-3">Timeline Information</h4>
                                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
                                                        <div>
                                                            <p className="font-medium text-gray-600">Created</p>
                                                            <p className="text-gray-800">{new Date(mockMeeting.createdAt).toLocaleString('en-GB')}</p>
                                                        </div>
                                                        <div>
                                                            <p className="font-medium text-gray-600">Last Updated</p>
                                                            <p className="text-gray-800">{new Date(mockMeeting.updatedAt).toLocaleString('en-GB')}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Implementation Summary */}
                    <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mt-6">
                        <h3 className="text-lg font-semibold text-gray-900 mb-4">
                            🔧 Implementation Summary
                        </h3>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="bg-red-50 border border-red-200 rounded-lg p-4">
                                <h4 className="font-medium text-red-800 mb-2">❌ Before (Issues)</h4>
                                <ul className="text-sm text-red-700 space-y-1">
                                    <li>• Images not loading - using raw primaryImageUrl</li>
                                    <li>• No proper fallback handling</li>
                                    <li>• Inconsistent with table view image handling</li>
                                    <li>• Backend uploaded images not displaying</li>
                                </ul>
                            </div>
                            
                            <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                                <h4 className="font-medium text-green-800 mb-2">✅ After (Fixed)</h4>
                                <ul className="text-sm text-green-700 space-y-1">
                                    <li>• Using <code>getImageUrl()</code> for proper URL formatting</li>
                                    <li>• Support for backend uploaded images</li>
                                    <li>• Gem-type-specific fallback images</li>
                                    <li>• Consistent image handling across components</li>
                                    <li>• Admin contact visibility maintained for oversight</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<AdminMeetingDetailsTest />, document.getElementById('root'));
    </script>
</body>
</html>