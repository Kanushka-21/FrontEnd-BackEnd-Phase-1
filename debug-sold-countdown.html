<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Sold Items Countdown</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .debug-section { border: 1px solid #ccc; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .status-sold { background-color: #f8d7da; }
        .status-active { background-color: #d4edda; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîç Debug: Sold Items Countdown Issue</h1>
    
    <div class="debug-section">
        <h3>Step 1: Check API Response</h3>
        <button onclick="checkAPI()">Check Marketplace API</button>
        <div id="apiResult"></div>
    </div>
    
    <div class="debug-section">
        <h3>Step 2: Open Browser Console</h3>
        <p>1. Open the marketplace: <button onclick="openMarketplace()">Open Marketplace</button></p>
        <p>2. Press F12 to open Developer Tools</p>
        <p>3. Go to the Console tab</p>
        <p>4. Look for these messages:</p>
        <ul>
            <li><code>üîç GemstoneCard rendered for [name]: [object]</code></li>
            <li><code>‚è∞ CountdownTimer props for listing [id]:</code></li>
            <li><code>üõë SOLD ITEM DETECTED: [id] - listingStatus: "sold"</code></li>
        </ul>
    </div>
    
    <div class="debug-section">
        <h3>Step 3: Expected Behavior</h3>
        <p><strong>For Sold Items:</strong></p>
        <ul>
            <li>‚úÖ Should see: "üõë SOLD ITEM DETECTED" in console</li>
            <li>‚úÖ Should show: "Bidding Closed" text</li>
            <li>‚úÖ Should show: "SOLD" badge</li>
            <li>‚ùå Should NOT show: Countdown numbers</li>
        </ul>
        
        <p><strong>If still showing countdown:</strong></p>
        <ul>
            <li>Check if listingStatus is exactly "sold" (case sensitive)</li>
            <li>Verify CountdownTimer receives the listingStatus prop</li>
            <li>Look for any React rendering issues</li>
        </ul>
    </div>

    <script>
        async function checkAPI() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.innerHTML = '<p>üîÑ Checking API...</p>';
            
            try {
                const response = await fetch('http://localhost:9092/api/marketplace/listings?includeSold=true&size=5');
                const data = await response.json();
                
                if (data.success) {
                    let html = '<h4>API Response Analysis:</h4>';
                    
                    data.data.listings.forEach((item, index) => {
                        const statusClass = item.listingStatus === 'sold' ? 'status-sold' : 'status-active';
                        html += `
                            <div class="debug-section ${statusClass}">
                                <strong>Item ${index + 1}: ${item.name || 'Unnamed'}</strong><br>
                                <code>listingStatus: "${item.listingStatus}"</code><br>
                                <code>biddingActive: ${item.biddingActive}</code><br>
                                <code>isExpired: ${item.isExpired}</code><br>
                                <strong>Expected Frontend Behavior:</strong> 
                                ${item.listingStatus === 'sold' ? 
                                  '<span style="color: red;">Should show "Bidding Closed - SOLD"</span>' : 
                                  '<span style="color: green;">Should show countdown timer</span>'}
                            </div>
                        `;
                    });
                    
                    resultDiv.innerHTML = html;
                } else {
                    throw new Error(data.message || 'API request failed');
                }
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        function openMarketplace() {
            window.open('http://localhost:5173', '_blank');
        }
    </script>
</body>
</html>
