<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meeting System API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { margin: 5px; padding: 10px 15px; cursor: pointer; }
        #results { margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 5px; }
        pre { background: #eee; padding: 10px; border-radius: 3px; overflow: auto; }
    </style>
</head>
<body>
    <h1>üóìÔ∏è Meeting System API Test</h1>
    <p>Test the new meeting scheduling system APIs</p>

    <div class="test-section">
        <h2>API Endpoint Tests</h2>
        <button onclick="testCreateMeeting()">Test Create Meeting</button>
        <button onclick="testGetUserMeetings()">Test Get User Meetings</button>
        <button onclick="testConfirmMeeting()">Test Confirm Meeting</button>
        <button onclick="testRescheduleMeeting()">Test Reschedule Meeting</button>
    </div>

    <div id="results">
        <h3>Test Results:</h3>
        <div id="output">Click a test button above to see results...</div>
    </div>

    <script>
        const API_BASE = 'http://localhost:9092/api';
        
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            output.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }

        function clearResults() {
            document.getElementById('output').innerHTML = '';
        }

        async function apiCall(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }

                log(`üîÑ ${method} ${endpoint}`, 'info');
                
                const response = await fetch(`${API_BASE}${endpoint}`, options);
                const result = await response.json();
                
                if (response.ok) {
                    log(`‚úÖ Success: ${response.status}`, 'success');
                    log(`<pre>${JSON.stringify(result, null, 2)}</pre>`, 'info');
                } else {
                    log(`‚ùå Error: ${response.status} - ${response.statusText}`, 'error');
                    log(`<pre>${JSON.stringify(result, null, 2)}</pre>`, 'error');
                }
                
                return { response, result };
            } catch (error) {
                log(`üí• Network Error: ${error.message}`, 'error');
                return { error };
            }
        }

        async function testCreateMeeting() {
            clearResults();
            log('üß™ Testing Create Meeting API...', 'info');
            
            const meetingData = {
                purchaseId: "test-purchase-001",
                buyerId: "test-buyer-001", 
                proposedDateTime: "2025-08-25T14:30:00",
                location: "Colombo Gem Market",
                meetingType: "PHYSICAL",
                buyerNotes: "Looking forward to inspecting the gemstone"
            };
            
            await apiCall('/meetings/create', 'POST', meetingData);
        }

        async function testGetUserMeetings() {
            clearResults();
            log('üß™ Testing Get User Meetings API...', 'info');
            
            const userId = "test-buyer-001";
            await apiCall(`/meetings/user/${userId}`, 'GET');
        }

        async function testConfirmMeeting() {
            clearResults();
            log('üß™ Testing Confirm Meeting API...', 'info');
            
            const meetingId = "test-meeting-001";
            const confirmData = {
                sellerNotes: "Meeting confirmed. Please bring identification."
            };
            
            await apiCall(`/meetings/${meetingId}/confirm`, 'PUT', confirmData);
        }

        async function testRescheduleMeeting() {
            clearResults();
            log('üß™ Testing Reschedule Meeting API...', 'info');
            
            const meetingId = "test-meeting-001";
            const rescheduleData = {
                newDateTime: "2025-08-26T15:00:00",
                notes: "Had to reschedule due to prior commitment"
            };
            
            await apiCall(`/meetings/${meetingId}/reschedule`, 'PUT', rescheduleData);
        }

        // Test backend availability on page load
        window.onload = async function() {
            log('üîÑ Testing backend connectivity...', 'info');
            try {
                const response = await fetch(`${API_BASE}/health`);
                if (response.ok) {
                    log('‚úÖ Backend is running and accessible!', 'success');
                } else {
                    log('‚ö†Ô∏è Backend responded but may have issues', 'error');
                }
            } catch (error) {
                log('‚ùå Backend is not accessible. Make sure it\'s running on port 9092', 'error');
            }
        };
    </script>
</body>
</html>
