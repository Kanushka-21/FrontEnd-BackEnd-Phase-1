<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Notification System Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .priority-high { background: #ffebee; border-left: 4px solid #f44336; }
        .priority-medium { background: #fff3e0; border-left: 4px solid #ff9800; }
        .priority-low { background: #e8f5e8; border-left: 4px solid #4caf50; }
        .notification-item { margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üîî Admin Notification System Test</h1>
    
    <div class="test-section">
        <h2>Admin Notification API Test</h2>
        <p class="info">Testing admin-specific notification endpoints</p>
        <button onclick="testAdminNotifications()">Test Admin Notifications API</button>
        <button onclick="testUnreadCount()">Test Unread Count API</button>
        <button onclick="testMarkAsRead()">Test Mark as Read API</button>
        <div id="adminResult"></div>
    </div>
    
    <div class="test-section">
        <h2>Admin Notification Categories</h2>
        <p class="info">Testing different notification types and priorities</p>
        <button onclick="showNotificationsByCategory()">Show Notifications by Category</button>
        <div id="categoryResult"></div>
    </div>
    
    <div class="test-section">
        <h2>Real-time Notification Simulation</h2>
        <p class="info">Simulating real-time admin notifications</p>
        <button onclick="startNotificationSimulation()">Start Simulation</button>
        <button onclick="stopNotificationSimulation()">Stop Simulation</button>
        <div id="simulationResult"></div>
    </div>

    <script>
        let simulationInterval = null;
        
        async function testAdminNotifications() {
            const resultDiv = document.getElementById('adminResult');
            resultDiv.innerHTML = '<p class="info">Testing admin notifications...</p>';
            
            try {
                const userId = 'admin123'; // Mock admin user ID
                const response = await fetch(`http://localhost:9092/api/admin/notifications/${userId}?page=0&size=10`);
                const result = await response.json();
                
                if (result.success) {
                    const notifications = result.data.notifications || [];
                    let html = `
                        <h3 class="success">‚úÖ Admin Notifications API Working!</h3>
                        <p><strong>Total Notifications:</strong> ${result.data.total}</p>
                        <p><strong>Unread Count:</strong> ${result.data.unreadCount}</p>
                        <h4>Notifications:</h4>
                    `;
                    
                    notifications.forEach(notification => {
                        const priorityClass = `priority-${notification.priority}`;
                        html += `
                            <div class="notification-item ${priorityClass}">
                                <h5>${notification.title} 
                                    <span style="font-size: 12px; background: #007bff; color: white; padding: 2px 6px; border-radius: 3px;">
                                        ${notification.section.toUpperCase()}
                                    </span>
                                    <span style="font-size: 12px; background: ${notification.priority === 'high' ? '#f44336' : notification.priority === 'medium' ? '#ff9800' : '#4caf50'}; color: white; padding: 2px 6px; border-radius: 3px;">
                                        ${notification.priority.toUpperCase()}
                                    </span>
                                </h5>
                                <p>${notification.message}</p>
                                <small>Type: ${notification.type} | Read: ${notification.isRead ? 'Yes' : 'No'} | Action Required: ${notification.actionRequired ? 'Yes' : 'No'}</small>
                            </div>
                        `;
                    });
                    
                    html += `<pre>${JSON.stringify(result, null, 2)}</pre>`;
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = `<p class="error">‚ùå API Error: ${result.message}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        async function testUnreadCount() {
            const resultDiv = document.getElementById('adminResult');
            resultDiv.innerHTML = '<p class="info">Testing unread count...</p>';
            
            try {
                const userId = 'admin123';
                const response = await fetch(`http://localhost:9092/api/admin/notifications/${userId}/unread-count`);
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.innerHTML = `
                        <h3 class="success">‚úÖ Unread Count API Working!</h3>
                        <p><strong>Unread Count:</strong> ${result.data}</p>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">‚ùå API Error: ${result.message}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        async function testMarkAsRead() {
            const resultDiv = document.getElementById('adminResult');
            resultDiv.innerHTML = '<p class="info">Testing mark as read...</p>';
            
            try {
                const notificationId = '1';
                const response = await fetch(`http://localhost:9092/api/admin/notifications/${notificationId}/read`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' }
                });
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.innerHTML = `
                        <h3 class="success">‚úÖ Mark as Read API Working!</h3>
                        <p><strong>Status:</strong> ${result.data}</p>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">‚ùå API Error: ${result.message}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        function showNotificationsByCategory() {
            const resultDiv = document.getElementById('categoryResult');
            
            const categories = {
                'Dashboard Overview': {
                    types: ['SYSTEM_ALERT', 'PERFORMANCE_WARNING'],
                    description: 'System alerts, performance metrics, general dashboard notifications'
                },
                'User Management': {
                    types: ['USER_REGISTRATION', 'VERIFICATION_REQUEST', 'USER_SUSPENDED'],
                    description: 'New registrations, verification requests, user account issues'
                },
                'Listing Management': {
                    types: ['LISTING_PENDING', 'LISTING_REPORTED', 'LISTING_EXPIRED'],
                    description: 'Pending listings, reported content, approval requests'
                },
                'Advertisement Management': {
                    types: ['ADVERTISEMENT_PENDING', 'AD_EXPIRED', 'AD_PAYMENT_DUE'],
                    description: 'New ads, approval requests, payment notifications'
                },
                'Meeting Requests': {
                    types: ['MEETING_REQUEST', 'MEETING_CANCELLED', 'MEETING_RESCHEDULED'],
                    description: 'New meeting requests, scheduling updates, cancellations'
                }
            };
            
            let html = '<h3>Admin Notification Categories</h3>';
            
            Object.entries(categories).forEach(([category, info]) => {
                html += `
                    <div class="notification-item">
                        <h4>${category}</h4>
                        <p><strong>Types:</strong> ${info.types.join(', ')}</p>
                        <p><strong>Description:</strong> ${info.description}</p>
                    </div>
                `;
            });
            
            resultDiv.innerHTML = html;
        }
        
        function startNotificationSimulation() {
            const resultDiv = document.getElementById('simulationResult');
            
            if (simulationInterval) {
                stopNotificationSimulation();
            }
            
            let count = 0;
            const mockNotifications = [
                { type: 'USER_REGISTRATION', section: 'users', priority: 'high', message: 'New seller registration requires verification' },
                { type: 'LISTING_PENDING', section: 'listings', priority: 'medium', message: 'Gemstone listing pending approval' },
                { type: 'MEETING_REQUEST', section: 'meetings', priority: 'medium', message: 'New meeting request scheduled' },
                { type: 'SYSTEM_ALERT', section: 'settings', priority: 'high', message: 'System performance warning detected' },
                { type: 'ADVERTISEMENT_PENDING', section: 'advertisements', priority: 'low', message: 'Advertisement approval required' }
            ];
            
            resultDiv.innerHTML = '<h3>üîÑ Real-time Notification Simulation Active</h3><div id="notificationStream"></div>';
            
            simulationInterval = setInterval(() => {
                const notification = mockNotifications[count % mockNotifications.length];
                const streamDiv = document.getElementById('notificationStream');
                
                const notificationHtml = `
                    <div class="notification-item priority-${notification.priority}" style="animation: fadeIn 0.5s;">
                        <strong>[${new Date().toLocaleTimeString()}] ${notification.type}</strong><br>
                        Section: ${notification.section} | Priority: ${notification.priority}<br>
                        ${notification.message}
                    </div>
                `;
                
                streamDiv.innerHTML = notificationHtml + streamDiv.innerHTML;
                
                // Keep only last 5 notifications
                const items = streamDiv.children;
                if (items.length > 5) {
                    streamDiv.removeChild(items[items.length - 1]);
                }
                
                count++;
            }, 3000);
        }
        
        function stopNotificationSimulation() {
            if (simulationInterval) {
                clearInterval(simulationInterval);
                simulationInterval = null;
                
                const resultDiv = document.getElementById('simulationResult');
                resultDiv.innerHTML += '<p class="info">‚èπÔ∏è Simulation stopped</p>';
            }
        }
        
        // Auto-test on load
        window.onload = function() {
            setTimeout(testAdminNotifications, 1000);
        };
    </script>
</body>
</html>
