<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Meeting Images Debug - Real Issue Analysis</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
        }
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .debug-section {
            margin: 30px 0;
            padding: 25px;
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            border-left: 4px solid #ff6b6b;
        }
        .success-section {
            border-left-color: #51cf66;
        }
        .warning-section {
            border-left-color: #ffd43b;
        }
        h1 { 
            text-align: center; 
            margin-bottom: 40px;
            font-size: 2.2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        h2 { 
            color: #FFD700; 
            margin-bottom: 20px;
            font-size: 1.4em;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .test-card {
            background: rgba(255,255,255,0.15);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        .test-card:hover {
            transform: translateY(-5px);
        }
        .test-image {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }
        .test-image.loading {
            border-color: #ffd43b;
            opacity: 0.7;
        }
        .test-image.success {
            border-color: #51cf66;
            box-shadow: 0 0 20px rgba(81, 207, 102, 0.4);
        }
        .test-image.error {
            border-color: #ff6b6b;
            opacity: 0.4;
        }
        .status {
            margin-top: 15px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
            display: inline-block;
        }
        .status.loading { background: rgba(255, 212, 59, 0.3); color: #ffd43b; }
        .status.loaded { background: rgba(81, 207, 102, 0.3); color: #51cf66; }
        .status.failed { background: rgba(255, 107, 107, 0.3); color: #ff6b6b; }
        .api-box {
            background: rgba(0,0,0,0.4);
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
        }
        .url-test {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            margin: 8px 0;
            border-radius: 6px;
            font-family: monospace;
            font-size: 11px;
            word-break: break-all;
        }
        button {
            padding: 12px 25px;
            background: linear-gradient(45deg, #ff6b6b, #ff8787);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        .success-indicator {
            display: inline-block;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 10px;
            animation: pulse 2s infinite;
        }
        .success { background: #51cf66; }
        .error { background: #ff6b6b; }
        .warning { background: #ffd43b; }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Meeting Images Debug - Real Issue Analysis</h1>
        
        <div class="debug-section warning-section">
            <h2><span class="success-indicator warning"></span>Issue Analysis</h2>
            <p><strong>Problem:</strong> Meeting sections showing dummy images instead of real gemstone images</p>
            <p><strong>Root Cause:</strong> Image paths not resolving correctly to backend resources</p>
            <p><strong>Testing Strategy:</strong> Check each possible image URL path systematically</p>
        </div>

        <div class="debug-section">
            <h2><span class="success-indicator error"></span>Backend Image Path Tests</h2>
            <p>Testing all possible backend image URLs to find which ones work:</p>
            <button onclick="testBackendPaths()">üîç Test All Backend Paths</button>
            <div class="test-grid" id="backend-tests"></div>
        </div>

        <div class="debug-section">
            <h2><span class="success-indicator warning"></span>Meeting API Data</h2>
            <p>Let's check what the meeting API is actually returning:</p>
            <button onclick="testMeetingAPI()">üì° Test Meeting API</button>
            <div class="api-box" id="api-result">Click button to test API...</div>
        </div>

        <div class="debug-section success-section">
            <h2><span class="success-indicator success"></span>React Component Simulation</h2>
            <p>Simulating the GemstoneImage component fallback logic:</p>
            <button onclick="simulateReactComponent()">‚öõÔ∏è Simulate Component Logic</button>
            <div class="test-grid" id="react-simulation"></div>
        </div>

        <div class="debug-section">
            <h2><span class="success-indicator warning"></span>Network Diagnostics</h2>
            <p>Testing network connectivity and CORS:</p>
            <button onclick="testNetworkDiagnostics()">üåê Run Network Tests</button>
            <div class="api-box" id="network-results">Click button to run diagnostics...</div>
        </div>
    </div>

    <script>
        // Test image filenames from backend directory
        const testImages = [
            'IMG_1751571383560_0.jpg',
            'IMG_1751571383559_0.jpg', 
            'GEM_20241101_143058.jpg',
            'GEM_20241101_143025.jpg',
            'GEM_20241101_143105.jpg',
            'ruby_sample.jpg',
            'emerald_sample.jpg',
            'sapphire_sample.jpg'
        ];

        // Different backend path patterns to test
        const backendPaths = [
            'http://localhost:9092/uploads/gems/',
            'http://localhost:9092/uploads/images/', 
            'http://localhost:9092/uploads/',
            'http://localhost:9092/api/files/gems/',
            'http://localhost:9092/api/files/gem-images/',
            'http://localhost:9092/static/gems/',
            'http://localhost:9092/static/uploads/gems/'
        ];

        function createTestCard(imagePath, description, containerId, testType = 'image') {
            const container = document.getElementById(containerId);
            if (!container) return;

            const card = document.createElement('div');
            card.className = 'test-card';
            
            if (testType === 'image') {
                const img = document.createElement('img');
                img.className = 'test-image loading';
                img.src = imagePath;
                
                const status = document.createElement('div');
                status.className = 'status loading';
                status.textContent = '‚è≥ Loading...';
                
                const desc = document.createElement('div');
                desc.innerHTML = `<strong>${description}</strong>`;
                desc.style.marginBottom = '10px';
                
                const urlDiv = document.createElement('div');
                urlDiv.className = 'url-test';
                urlDiv.textContent = imagePath;
                
                let loadStartTime = Date.now();
                
                img.onload = function() {
                    const loadTime = Date.now() - loadStartTime;
                    img.classList.remove('loading');
                    img.classList.add('success');
                    status.className = 'status loaded';
                    status.textContent = `‚úÖ Loaded (${loadTime}ms)`;
                    console.log(`SUCCESS: ${imagePath} loaded in ${loadTime}ms`);
                };
                
                img.onerror = function() {
                    img.classList.remove('loading');
                    img.classList.add('error');
                    status.className = 'status failed';
                    status.textContent = '‚ùå Failed to Load';
                    console.log(`ERROR: ${imagePath} failed to load`);
                };
                
                card.appendChild(desc);
                card.appendChild(img);
                card.appendChild(urlDiv);
                card.appendChild(status);
                
            } else if (testType === 'text') {
                const content = document.createElement('div');
                content.innerHTML = description;
                card.appendChild(content);
            }
            
            container.appendChild(card);
        }

        function testBackendPaths() {
            const container = document.getElementById('backend-tests');
            container.innerHTML = ''; // Clear previous results
            
            let testCount = 0;
            const maxTests = 20; // Limit to prevent overwhelming
            
            backendPaths.forEach(basePath => {
                testImages.forEach(filename => {
                    if (testCount >= maxTests) return;
                    
                    const fullUrl = basePath + filename;
                    const description = `${basePath.split('/').pop()} + ${filename}`;
                    createTestCard(fullUrl, description, 'backend-tests');
                    testCount++;
                });
            });
        }

        async function testMeetingAPI() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.innerHTML = '<div style="color: #ffd43b;">üîç Fetching meeting data...</div>';
            
            try {
                const response = await fetch('http://localhost:9092/api/meetings/admin/all', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });
                
                const contentType = response.headers.get('content-type');
                let data;
                
                if (contentType && contentType.includes('application/json')) {
                    data = await response.json();
                } else {
                    const text = await response.text();
                    data = { error: 'Non-JSON response', body: text.substring(0, 500) };
                }
                
                resultDiv.innerHTML = `
                    <div><strong>üìä API Response Analysis:</strong></div>
                    <div>üåê Status: ${response.status} ${response.statusText}</div>
                    <div>üìã Content-Type: ${contentType}</div>
                    <div>‚úÖ Success: ${data.success || 'N/A'}</div>
                    <div>üìà Meeting Count: ${data.count || 0}</div>
                    <div>üîç First Meeting primaryImageUrl: ${data.meetings?.[0]?.primaryImageUrl || 'NULL/UNDEFINED'}</div>
                    <div style="margin-top: 15px;"><strong>üìù Sample Meeting Data:</strong></div>
                    <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 10px;">${JSON.stringify(data.meetings?.[0] || data, null, 2).substring(0, 1000)}</pre>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="color: #ff6b6b;">‚ùå <strong>API Error:</strong></div>
                    <div>üö® Error Type: ${error.name}</div>
                    <div>üí¨ Message: ${error.message}</div>
                    <div>üîç This suggests the backend is not running or not accessible</div>
                `;
            }
        }

        function simulateReactComponent() {
            const container = document.getElementById('react-simulation');
            container.innerHTML = '';
            
            // Simulate what the React component would do with null/undefined primaryImageUrl
            const mockMeetingData = [
                { primaryImageUrl: null, gemName: 'Ruby', clientName: 'John Doe' },
                { primaryImageUrl: undefined, gemName: 'Emerald', clientName: 'Jane Smith' },
                { primaryImageUrl: '', gemName: 'Sapphire', clientName: 'Mike Johnson' },
                { primaryImageUrl: 'IMG_1751571383560_0.jpg', gemName: 'Diamond', clientName: 'Sarah Wilson' }
            ];
            
            mockMeetingData.forEach((meeting, index) => {
                const description = `Meeting ${index + 1}: ${meeting.clientName}<br>
                                   Gem: ${meeting.gemName}<br>
                                   primaryImageUrl: ${meeting.primaryImageUrl || 'NULL'}`;
                
                // Simulate the GemstoneImage component logic
                let imageUrl;
                if (meeting.primaryImageUrl) {
                    imageUrl = `http://localhost:9092/uploads/gems/${meeting.primaryImageUrl}`;
                } else {
                    // Use fallback based on gem type (like our component does)
                    const gemType = meeting.gemName.toLowerCase();
                    if (gemType.includes('ruby')) {
                        imageUrl = 'https://images.unsplash.com/photo-1544829099-b9a0c5303bea?w=150&h=150&fit=crop&crop=center';
                    } else if (gemType.includes('emerald')) {
                        imageUrl = 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=150&h=150&fit=crop&crop=center';
                    } else if (gemType.includes('sapphire')) {
                        imageUrl = 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=150&h=150&fit=crop&crop=center';
                    } else {
                        imageUrl = 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=150&h=150&fit=crop&crop=center';
                    }
                }
                
                createTestCard(imageUrl, description, 'react-simulation');
            });
        }

        async function testNetworkDiagnostics() {
            const resultDiv = document.getElementById('network-results');
            resultDiv.innerHTML = '<div style="color: #ffd43b;">üîç Running network diagnostics...</div>';
            
            const tests = [
                { name: 'Backend Health Check', url: 'http://localhost:9092/api/health' },
                { name: 'Backend Root', url: 'http://localhost:9092/' },
                { name: 'Uploads Directory', url: 'http://localhost:9092/uploads/' },
                { name: 'Gems Directory', url: 'http://localhost:9092/uploads/gems/' },
                { name: 'Test Image Direct', url: 'http://localhost:9092/uploads/gems/IMG_1751571383560_0.jpg' }
            ];
            
            let results = '<div><strong>üåê Network Diagnostic Results:</strong></div><br>';
            
            for (const test of tests) {
                try {
                    const response = await fetch(test.url, { method: 'HEAD' });
                    results += `<div>‚úÖ ${test.name}: ${response.status} ${response.statusText}</div>`;
                } catch (error) {
                    results += `<div>‚ùå ${test.name}: ${error.message}</div>`;
                }
            }
            
            resultDiv.innerHTML = results;
        }

        // Auto-run initial tests
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîß Meeting Images Debug Tool Loaded');
            console.log('üìã Testing Strategy:');
            console.log('   1. Test backend image paths');  
            console.log('   2. Check meeting API data');
            console.log('   3. Simulate React component logic');
            console.log('   4. Run network diagnostics');
            
            // Auto-run API test after 2 seconds
            setTimeout(() => {
                testMeetingAPI();
            }, 2000);
        });
    </script>
</body>
</html>